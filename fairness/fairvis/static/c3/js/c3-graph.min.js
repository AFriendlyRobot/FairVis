(function(){var r={}.hasOwnProperty,t=function(n,t){function u(){this.constructor=n}for(var i in t)r.call(t,i)&&(n[i]=t[i]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n},n=function(n,t){return function(){return n.apply(t,arguments)}},i=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};c3.Graph=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.version=.1,i.prototype.type="graph",i}(c3.Chart);c3.Sankey=function(r){function u(){return this._style=n(this._style,this),this._draw=n(this._draw,this),this._layout=n(this._layout,this),this._update=n(this._update,this),this._size=n(this._size,this),this._init=n(this._init,this),u.__super__.constructor.apply(this,arguments)}return t(u,r),u.version=.1,u.prototype.type="sankey",u.prototype.data=[],u.prototype.links=[],u.prototype.key=void 0,u.prototype.value=void 0,u.prototype.link_source=void 0,u.prototype.link_target=void 0,u.prototype.link_key=void 0,u.prototype.link_value=void 0,u.prototype.iterations=32,u.prototype.alpha=.99,u.prototype.node_padding="20%",u.prototype.node_width=30,u.prototype.align="both",u.prototype.link_path="curve",u.prototype.link_path_curvature=.5,u.prototype.nodes_options=void 0,u.prototype.node_options=void 0,u.prototype.rect_options=void 0,u.prototype.links_options=void 0,u.prototype.link_options=void 0,u.prototype.path_options=void 0,u.prototype.node_label_options=void 0,u.prototype.link_label_options=void 0,u.prototype._init=function(){return this.h=d3.scale.linear(),this.v=d3.scale.linear(),this.key==null&&(this.key=function(n){return function(t){return n.data.indexOf(t)}}(this)),this.link_key==null&&(this.link_key=function(n){return function(t){return n.link_source(t)+","+n.link_target(t)}}(this)),this.link_source==null&&(this.link_source=function(n){return n.source}),this.link_target==null&&(this.link_target=function(n){return n.target}),this.link_value==null&&(this.link_value=function(n){return n.value}),this.background=this.content.select("rect.background").singleton().position({x:0,y:0})},u.prototype._size=function(){return this.v.range([0,this.height]),this.background.position({width:this.width,height:this.height}),isNaN(this.node_padding)?void 0:this._update()},u.prototype._update=function(n){var s,k,e,ot,u,r,h,st,d,t,o,f,l,a,g,v,c,y,p,w,b,ht,ct,lt,at,nt,tt,it,rt,ut,ft,et;if(n!=="render"||isNaN(this.node_padding)){for(this.nodes=f={},this.node_links=o={},k=[],it=this.links,y=0,ht=it.length;y<ht;y++)if(r=it[y],h=this.link_key(r),st=this.link_value(r),st){if(o[h]!=null)throw Error("Link with duplicate source and target specified");k.push(r);o[h]={value:this.link_value(r)};t=f[nt=this.link_source(r)]!=null?f[nt]:f[nt]={source_links:[],target_links:[]};t.target_links.push(r);t=f[tt=this.link_target(r)]!=null?f[tt]:f[tt]={source_links:[],target_links:[]};t.source_links.push(r)}if(s=function(){var n,r,t,i;for(t=this.data,i=[],n=0,r=t.length;n<r;n++)e=t[n],this.key(e)in this.nodes&&i.push(e);return i}.call(this),this.value!=null)for(p=0,ct=s.length;p<ct;p++)e=s[p],f[this.key(e)].value=this.value(e);else for(u=this.key,h=this.link_key,w=0,lt=s.length;w<lt;w++)e=s[w],t=f[u(e)],t.value=Math.max(d3.sum(t.source_links,function(n){return o[h(n)].value}),d3.sum(t.target_links,function(n){return o[h(n)].value}));for(u in f)if(t=f[u],t.value==null)throw Error("Missing nodes are not currently supported");rt=this.nodes;for(u in rt)t=rt[u],t.links_sum=d3.sum(t.source_links,function(n){return function(t){return n.node_links[n.link_key(t)].value}}(this))+d3.sum(t.target_links,function(n){return function(t){return n.node_links[n.link_key(t)].value}}(this));v={};ut=this.nodes;for(u in ut)(t=ut[u],v[u])||(a=[],(ot=function(n){return function(t,u){var h,e,s,l,c;for(v[t]=!0,a.push(u),c=u.target_links,s=0,l=c.length;s<l;s++)r=c[s],e=n.link_target(r),h=f[e],o[n.link_key(r)].backedge=i.call(a,h)>=0,v[e]||ot(e,h);return a.pop()}}(this))(u,t));for(l=this.nodes,c=0;!c3.util.isEmpty(l);){d={};for(u in l)for(t=l[u],t.x=c,ft=t.target_links,b=0,at=ft.length;b<at;b++)(r=ft[b],o[this.link_key(r)].backedge)||(g=this.link_target(r),d[g]=f[g]);l=d;c++}if(c--,this.align==="both"){et=this.nodes;for(u in et)t=et[u],t.target_links.length||(t.x=c)}return this.h.domain([0,c]),this._layout(n,s,k,this.nodes)}},u.prototype._layout=function(n,t,i,r){var ht,ct,f,e,c,s,ui,p,fi,lt,h,u,o,at,ei,w,l,b,vt,oi,k,yt,pt,a,wt,si,d,g,nt,bt,hi,ci,li,ai,vi,yi,pi,wi,bi,ki,di,gi,nr,tt,kt,it,rt,ut,v,dt,gt,ni,ti,y,ii,ri,tr,ft,et,ot,st;if(this.current_data=t,this.current_nodes=r,at=this.node_links,this.columns=e=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(function(){var n=[];for(fi in r)u=r[fi],n.push(u);return n}()).map(function(n){return n.values}),c3.array.sort_up(this.columns,function(n){return n[0].x}),isNaN(this.node_padding))if((typeof(si=this.node_padding).charAt=="function"?si.charAt(this.node_padding.length-1):void 0)==="%")for(g=0,ci=e.length;g<ci;g++)f=e[g],f.padding_percent=f.length===1?0:this.node_padding.slice(0,-1)/100,f.padding_percent===1&&(f.padding_percent=.999);else throw new Error("Unsupported node_padding parameter: "+this.node_padding);else for(d=0,hi=e.length;d<hi;d++)f=e[d],f.padding_percent=this.node_padding*(f.length-1)/this.height,f.padding_percent>.8&&(f.padding_percent=.8);for(pt=d3.max(function(){var n,i,t;for(t=[],n=0,i=e.length;n<i;n++)f=e[n],t.push(d3.sum(f,function(n){return n.value})/(1-f.padding_percent));return t}()),this.v.domain([0,pt]),nt=0,yi=e.length;nt<yi;nt++)f=e[nt],f.padding=f.length===1?0:pt*f.padding_percent/(f.length-1);if(ct=function(n){return function(){var t,i,r,h,c,o,s;for(s=[],r=0,h=e.length;r<h;r++){for(f=e[r],c3.array.sort_up(f,function(n){return n.y}),i=0,o=0,c=f.length;o<c;o++)u=f[o],t=i-u.y,t>0&&(u.y+=t),i=u.y+u.value+f.padding;u.y+u.value>n.v.domain()[1]?(i=n.v.domain()[1],s.push(function(){for(var r=[],n=f.length-1;n>=0;n+=-1){if(u=f[n],t=u.y+u.value-i,t>0)u.y-=t;else break;r.push(i=u.y-f.padding)}return r}())):s.push(void 0)}return s}}(this),lt=function(n){return function(){var h,i,a,v,y,t,c,o,s,l,w,p;for(a=n.link_key,v=n.link_source,y=n.link_target,p=[],l=0,w=e.length;l<w;l++)f=e[l],h=f.length>1?f.padding:f.length===1?n.v.domain()[1]-f[0].value:0,p.push(function(){var w,b,n,e,l,p;for(p=[],n=0,w=f.length;n<w;n++){for(u=f[n],c3.array.sort_up(u.source_links,function(n){return function(t){return n.nodes[v(t)].y}}(this)),o=u.y-h/2,c=h/(u.source_links.length-1),s=u.y,l=u.source_links,e=0,b=l.length;e<b;e++)i=l[e],t=at[a(i)],t.ty=s,s+=t.value,t.tx=u.x,v(i)in r||(t.sx=u.x-.5,t.sy=o,this.v(t.value)>this.h(.25)&&(t.sx-=this.h.invert(this.v(t.value))),this.v(t.sy).toFixed(3)===this.v(t.ty).toFixed(3)&&(t.sy+=this.v.invert(1))),o+=t.value+c;c3.array.sort_up(u.target_links,function(n){return function(t){return n.nodes[y(t)].y}}(this));s=u.y;o=u.y-h/2;c=h/(u.target_links.length-1);p.push(function(){var h,n,f,e;for(f=u.target_links,e=[],n=0,h=f.length;n<h;n++)i=f[n],t=at[a(i)],t.sy=s,s+=t.value,t.sx=u.x,y(i)in r||(t.tx=u.x+.5,t.ty=o,this.v(t.value)>this.h(.25)&&(t.tx+=this.h.invert(this.v(t.value))),this.v(t.sy).toFixed(3)===this.v(t.ty).toFixed(3)&&(t.ty+=this.v.invert(1))),e.push(o+=t.value+c);return e}.call(this))}return p}.call(n));return p}}(this),wt=0,e.length){for(c3.array.sort_up(e[0],function(n){return n.value}),oi=e[0].slice(0),dt=d3.merge([function(){var n,i,t;for(t=[],s=n=i=e[0].length-1;n>=0;s=n+=-2)t.push(s);return t}(),function(){var n,r,i,t;for(t=[],s=n=r=e[0].length%2,i=e[0].length-1;n<=i;s=n+=2)t.push(s);return t}()]),s=bt=0,pi=dt.length;bt<pi;s=++bt)ei=dt[s],e[0][s]=oi[ei];for(gt=e[0],tt=0,wi=gt.length;tt<wi;tt++)u=gt[tt],u.y=wt,wt+=u.value+e[0].padding}for(p=kt=0,bi=e.length;kt<bi;p=++kt)if(f=e[p],p)for(it=0,ki=f.length;it<ki;it++){for(u=f[it],a=0,w=0,yt=0,k=0,ni=u.source_links,rt=0,di=ni.length;rt<di;rt++)(h=ni[rt],o=this.node_links[this.link_key(h)],l=r[this.link_source(h)],l!=null)&&((yt+=l.y*o.value,k+=o.value,l.x>=u.x)||(a+=l.y*o.value,w+=o.value));if(w)u.y=a/w;else if(k)u.y=yt/k;else{for(b=0,ti=u.target_links,ut=0,gi=ti.length;ut<gi;ut++)(h=ti[ut],o=this.node_links[this.link_key(h)],vt=r[this.link_target(h)],vt!=null)&&(a+=vt.y*o.value,b+=o.value);if(!b)throw"assertion error: Orphan node";u.y=a/b}}for(ct(),lt(),ht=1,ui=v=0,y=this.iterations;0<=y?v<y:v>y;ui=0<=y?++v:--v){for(ht*=this.alpha,ft=0,nr=e.length;ft<nr;ft++)for(f=e[ft],et=0,li=f.length;et<li;et++){for(u=f[et],c=0,ii=u.source_links,ot=0,ai=ii.length;ot<ai;ot++)h=ii[ot],o=this.node_links[this.link_key(h)],o.tx>o.sx&&(c+=(o.sy-o.ty)*o.value);for(ri=u.target_links,st=0,vi=ri.length;st<vi;st++)h=ri[st],o=this.node_links[this.link_key(h)],o.tx>o.sx&&(c+=(o.ty-o.sy)*o.value);c/=u.links_sum;u.y+=c*ht}ct();lt()}return this.links_layer=this.content.select("g.links").singleton().options(this.links_options).update(),this.link_g=this.links_layer.select("g.link").options(this.link_options).animate(n!=="render").bind(i,this.link_key).update(),this.paths=this.link_g.inherit("path").options(this.path_options).update(),this.link_g.all.classed("backedge",function(n){return function(t){return n.node_links[n.link_key(t)].backedge}}(this)),this.nodes_layer=this.content.select("g.nodes").singleton().options(this.nodes_options).update(),this.node_g=this.nodes_layer.select("g.node").options(this.node_options).animate(n!=="render").bind(t,this.key).update(),this.rects=this.node_g.inherit("rect").options(this.rect_options).update(),this.node_label_options!=null?(this.node_labels_clip=this.node_g.inherit("svg.label","restore"),this.node_labels=this.node_labels_clip.inherit("text","restore").options(this.node_label_options).update()):((tr=this.node_labels_clip)!=null&&tr.all.remove(),delete this.node_labels,delete this.node_labels_clip)},u.prototype._draw=function(n){var i,t,r;if(isNaN(this.node_width))if((typeof(r=this.node_width).charAt=="function"?r.charAt(this.node_width.length-1):void 0)==="%")i=this.node_width.slice(0,-1)/100,t=i*this.width/(this.columns.length+i-1);else throw new Error("Unsupported node_width parameter: "+this.node_width);else t=this.node_width;return this.h.rangeRound([0,this.width-t]),this.node_g.animate(n!=="render"&&n!=="resize").position({transform:function(n){return function(t){var i;return"translate("+n.h(n.nodes[i=n.key(t)].x)+","+n.v(n.nodes[i].y)+")"}}(this)}),this.rects.animate(n!=="render"&&n!=="resize").position({width:t,height:function(n){return function(t){return Math.max(1,n.v(n.nodes[n.key(t)].value))}}(this)}),this.paths.animate(n!=="render"&&n!=="resize").position({d:function(n){return function(i){var s,r,u,f,e,o,h;r=n.node_links[n.link_key(i)];u=n.h(r.sx)+t;e=n.h(r.tx);switch(n.link_path){case"straight":return f=n.v(r.sy),o=n.v(r.ty),"M"+u+","+f+"L"+e+","+o+"l0,"+n.v(r.value)+"L"+u+","+(f+n.v(r.value))+"Z";case"curve":return s=e>u?n.link_path_curvature:-n.link_path_curvature*4,f=n.v(r.sy+r.value/2),o=n.v(r.ty+r.value/2),h=d3.interpolateRound(u,e),"M"+u+","+f+"C"+h(s)+","+f+" "+h(1-s)+","+o+" "+e+","+o;default:throw Error("Unknown link_path option: "+n.link_path);}}}(this),"stroke-width":this.link_path==="curve"?function(n){return function(t){return Math.max(1,n.v(n.node_links[n.link_key(t)].value))}}(this):void 0}),this.links_layer.all.attr("class","links "+this.link_path),this.node_labels!=null?this.node_label_options.orientation!=="vertical"?(this.node_labels.animate(n!=="render"&&n!=="resize").position({y:function(n){return function(t){return n.v(n.nodes[n.key(t)].value)/2}}(this),x:function(n){return function(i){return n.nodes[n.key(i)].x>n.h.domain()[1]/2?t:0}}(this),dx:function(n){return function(t){return n.nodes[n.key(t)].x>n.h.domain()[1]/2?"-0.25em":"0.25em"}}(this),dy:"0.4em"}),this.nodes_layer.all.classed({horizontal_labels:!0,vertical_labels:!1}),this.node_labels.all.style({"text-anchor":function(n){return function(t){return n.nodes[n.key(t)].x>n.h.domain()[1]/2?"end":"start"}}(this)})):(this.node_labels.animate(n!=="render"&&n!=="resize").position({y:t/2,x:function(n){return function(t){return-n.v(n.nodes[n.key(t)].value)}}(this),dx:"0.25em",dy:"0.4em"}),this.nodes_layer.all.classed({horizontal_labels:!1,vertical_labels:!0}),this.node_labels.all.style({"text-anchor":"start"})):void 0},u.prototype._style=function(n){var t,i;return this.node_g.options(this.node_options),this.rects.options(this.rect_options),(t=this.node_labels)!=null&&t.options(this.node_label_options),this.link_g.options(this.link_options),this.paths.options(this.path_options),this.nodes_layer.style(),this.node_g.style(n),this.rects.style(n),(i=this.node_labels)!=null&&i.style(n),this.links_layer.style(),this.link_g.style(n),this.paths.style(n)},u}(c3.Graph);c3.Butterfly=function(r){function u(){return this.focus=n(this.focus,this),this._style=n(this._style,this),this._butterfly_layout=n(this._butterfly_layout,this),this._butterfly_update=n(this._butterfly_update,this),this._update=n(this._update,this),this._init=n(this._init,this),u.__super__.constructor.apply(this,arguments)}return t(u,r),u.version=.1,u.prototype.type="butterfly",u.prototype.navigatable=!0,u.prototype.depth_of_field=2,u.prototype._init=function(){u.__super__._init.apply(this,arguments);return this.background["new"].on("click",function(n){return function(){return n.focus(null)}}(this))},u.prototype._update=function(n){var t;return(t=this.focal,i.call(this.data,t)<0)&&(this.focal=null),(n!=="focus"||this.focal==null)&&(u.__super__._update.apply(this,arguments),this._butterfly_update(),this._style(!0)),this.focal!=null?(this._butterfly_layout(),this._butterfly_update(),this._style(!0)):void 0},u.prototype._butterfly_update=function(){if(this.navigatable)this.rects["new"].on("click",function(n){return function(t){return d3.event.stopPropagation,n.focus(t)}}(this));return this.paths.all.attr("mask",function(n){return function(t){return n.link_source(t)in n.current_nodes?n.link_target(t)in n.current_nodes?null:"url(#mask_fade_right)":"url(#mask_fade_left)"}}(this))},u.prototype._butterfly_layout=function(){var f,r,u,t,e,n,i;return t=this.key(this.focal),e=this.nodes[t],n={},r=[],i=function(t){return function(u,f,e){var s,a,o,h,c,l,w,b,k,v,y,p;if(!n[u]&&(o=t.nodes[u],o!=null)){for(n[u]=o,o.x=t.depth_of_field+e*f,v=[o.source_links,o.target_links],h=0,w=v.length;h<w;h++)for(a=v[h],c=0,b=a.length;c<b;c++)s=a[c],r.push(s);if(e<t.depth_of_field){for(y=f===1?o.target_links:o.source_links,p=[],l=0,k=y.length;l<k;l++)s=y[l],p.push(i((f===1?t.link_target:t.link_source)(s),f,e+1));return p}}}}(this),i(t,1,0),delete n[t],i(t,-1,0),f=function(){var t,f,i,r;for(i=this.data,r=[],t=0,f=i.length;t<f;t++)u=i[t],this.key(u)in n&&r.push(u);return r}.call(this),this.h.domain([-.5,this.depth_of_field*2+.5]),this._layout("focus",f,r,n)},u.prototype._style=function(){return u.__super__._style.apply(this,arguments),this.content.all.classed("navigatable",this.navigatable)},u.prototype.focus=function(n){return this.focal=n,this.trigger("focus",n),this._update("focus"),this._draw("focus"),this.trigger("focusend",n)},u}(c3.Sankey)}).call(this);